<div class="user-form-container">
  <h2>User Information Form</h2>

  <form (ngSubmit)="onSubmit()" class="user-form">
    <!-- Basic Information Section -->
    <section class="form-section">
      <h3>Basic Information</h3>

      <div class="form-group">
        <app-input
          label="Full Name"
          placeholder="Enter full name"
          [value]="formData().name || ''"
          [required]="true"
          [errorMessage]="getFieldError('name')"
          (valueChange)="updateField('name', $event)"
        />
      </div>

      <div class="form-group">
        <app-input
          label="Job Title"
          placeholder="Enter job title"
          [value]="formData().title || ''"
          [required]="true"
          [errorMessage]="getFieldError('title')"
          (valueChange)="updateField('title', $event)"
        />
      </div>

      <div class="form-group">
        <app-input
          label="Avatar URL"
          placeholder="Enter avatar URL"
          [value]="formData().avatar || ''"
          (valueChange)="updateField('avatar', $event)"
        />
      </div>

      <div class="form-group">
        <app-input
          label="Description"
          placeholder="Enter description"
          [value]="formData().description || ''"
          [required]="true"
          [errorMessage]="getFieldError('description')"
          (valueChange)="updateField('description', $event)"
        />
      </div>
    </section>

    <!-- Professional Information Section -->
    <section class="form-section">
      <h3>Professional Information</h3>

      <div class="form-row">
        <div class="form-group">
          <app-dropdown
            label="Specialist Role"
            placeholder="Select specialist role"
            [options]="specialistOptions"
            [value]="formData().specialist || ''"
            [required]="true"
            [errorMessage]="getFieldError('specialist')"
            (valueChange)="updateSpecialist($event)"
          />
        </div>

        <div class="form-group">
          <app-dropdown
            label="Level"
            placeholder="Select level"
            [options]="levelOptions"
            [value]="formData().level || ''"
            [required]="true"
            [errorMessage]="getFieldError('level')"
            (valueChange)="updateLevel($event)"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <app-input
            label="Years in Company"
            placeholder="Enter years in company"
            type="number"
            [value]="formData().years_in_company?.toString() || '0'"
            [required]="true"
            [errorMessage]="getFieldError('years_in_company')"
            (valueChange)="updateNumericField('years_in_company', $event)"
          />
        </div>

        <div class="form-group">
          <app-dropdown
            label="Languages"
            placeholder="Select languages"
            [options]="languageOptions"
            [value]="formData().languages || []"
            [multiple]="true"
            [required]="true"
            [errorMessage]="getFieldError('languages')"
            (valueChange)="updateLanguages($event)"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <app-input
            label="Client Satisfaction (0-100)"
            placeholder="Enter client satisfaction score"
            type="number"
            [value]="formData().client_satisfaction?.toString() || '0'"
            [required]="true"
            [errorMessage]="getFieldError('client_satisfaction')"
            (valueChange)="updateNumericField('client_satisfaction', $event)"
          />
        </div>

        <div class="form-group">
          <app-input
            label="Job Happiness (0-100)"
            placeholder="Enter job happiness score"
            type="number"
            [value]="formData().job_happiness?.toString() || '0'"
            [required]="true"
            [errorMessage]="getFieldError('job_happiness')"
            (valueChange)="updateNumericField('job_happiness', $event)"
          />
        </div>
      </div>
    </section>

    <!-- Technologies Section -->
    <section class="form-section">
      <h3>Technologies</h3>

      <div class="technology-input-group">
        <app-input
          placeholder="Enter technology"
          [value]="technologyInput()"
          (valueChange)="updateTechnologyInput($event)"
          (keydown.enter)="addTechnology(); $event.preventDefault()"
        />
        <!-- <app-button
          type="button"
          variant="outline"
          (click)="addTechnology()"
          [disabled]="!technologyInput().trim()"
        >
          Add Technology
        </app-button> -->
      </div>

      <div class="technology-list" *ngIf="formData().technologies?.length">
        <div
          class="technology-tag"
          *ngFor="let tech of formData().technologies; let i = index"
        >
          <span>{{ tech }}</span>
          <button
            type="button"
            class="remove-btn"
            (click)="removeTechnology(i)"
            aria-label="Remove technology"
          >
            Ã—
          </button>
        </div>
      </div>
    </section>

    <!-- Current Project Section -->
    <section class="form-section">
      <h3>Current Project</h3>

      <div class="form-group">
        <app-input
          label="Project Title"
          placeholder="Enter current project title"
          [value]="currentProject().title"
          [errorMessage]="getFieldError('current_project_title')"
          (valueChange)="updateCurrentProject('title', $event)"
        />
      </div>

      <div class="form-group">
        <app-input
          label="Project Description"
          placeholder="Enter current project description"
          [value]="currentProject().description"
          [errorMessage]="getFieldError('current_project_description')"
          (valueChange)="updateCurrentProject('description', $event)"
        />
      </div>

      <div class="form-group">
        <app-dropdown
          label="Client"
          placeholder="Select client"
          [options]="clientOptions"
          [value]="currentProject().client"
          [errorMessage]="getFieldError('current_project_client')"
          (valueChange)="updateCurrentProjectClient($event)"
        />
      </div>
    </section>

    <!-- Dynamic Projects Section -->
    <section class="form-section">
      <div class="section-header">
        <h3>Previous Projects</h3>
        <app-button
          type="button"
          variant="outline"
          (click)="addProject(); $event.preventDefault()"
        >
          + Add Project
        </app-button>
      </div>

      <div class="projects-list">
        <div
          class="project-form"
          *ngFor="
            let project of projectInputs();
            let i = index;
            trackBy: trackByProjectId
          "
        >
          <div class="project-header">
            <h4>Project {{ i + 1 }}</h4>
            <button
              type="button"
              class="remove-project-btn"
              (click)="removeProject(project.id)"
              aria-label="Remove project"
            >
              Remove
            </button>
          </div>

          <div class="form-group">
            <app-input
              label="Project Title"
              placeholder="Enter project title"
              [value]="project.title"
              (valueChange)="updateProject(project.id, 'title', $event)"
            />
          </div>

          <div class="form-group">
            <app-input
              label="Project Description"
              placeholder="Enter project description"
              [value]="project.description"
              (valueChange)="updateProject(project.id, 'description', $event)"
            />
          </div>

          <div class="form-group">
            <app-dropdown
              label="Client"
              placeholder="Select client"
              [options]="clientOptions"
              [value]="project.client"
              (valueChange)="updateProjectClient(project.id, $event)"
            />
          </div>
        </div>

        <div class="no-projects" *ngIf="!projectInputs().length">
          <p>No previous projects added yet. Click "Add Project" to add one.</p>
        </div>
      </div>
    </section>

    <!-- Form Actions -->
    <section class="form-actions">
      <app-button
        type="button"
        variant="outline"
        (click)="resetForm()"
        [disabled]="isSubmitting()"
      >
        Reset Form
      </app-button>

      <app-button
        type="submit"
        variant="primary"
        [disabled]="!formValidation().isValid || isSubmitting()"
      >
        {{ isSubmitting() ? "Submitting..." : "Submit" }}
      </app-button>
    </section>

    <!-- Debug Information (remove in production) -->
    <section class="debug-section" *ngIf="!formValidation().isValid">
      <h4>Form Validation Errors:</h4>
      <ul>
        <li *ngFor="let error of formValidation().errors | keyvalue">
          <strong>{{ error.key }}:</strong> {{ error.value }}
        </li>
      </ul>
    </section>
  </form>
</div>
